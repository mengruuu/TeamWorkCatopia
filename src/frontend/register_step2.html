<!DOCTYPE html>
<html lang="en">
<head>
    @@include('./layout/meta.html', {
      "title" : "註冊第二頁"
    })
    <link rel="stylesheet" href="./css/register_second.css">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
    <script src="./library/jquery-3.6.0.min.js"></script>
</head>
<body>
    @@include('./layout/header.html')
    <div class = "register_second_container">
        <div class = "register_second_title">會員註冊</div>
        <div class = "register_second_process">
            <div class = "register_second_process_item">
                <p>輸入個人資料</p>
            </div>
            <div class = "register_second_process_item register_second_process_item_current">
                <p>確認輸入內容</p>
            </div>
            <div class = "register_second_process_item">
                <p>註冊完成</p>
            </div>
        </div>
        <form method = "post" action = "">
            <div class = "register_second_circle"></div>
            <label>帳號 / 密碼</label>
            <div class = "register_second_confirm">
                <div>
                    <p>帳號確認</p>
                </div>
                <div>
                    <label>帳號 / Email</label>
                    <p class = "register_second_confirm_account register_confirm"></p>
                    <div>
                        <label>密碼</label>
                        <i class="far fa-eye-slash"></i>
                        <i class="far fa-eye register_second_icon_hide"></i>
                    </div>
                    <p class = "register_second_confirm_password register_confirm">****</p>
                </div>
            </div>
            <div class = "register_second_circle"></div>
            <label>請輸入個人資料</label>
            <div class = "register_second_confirm">
                <div>
                    <p>個人資料確認</p>
                </div>
                <div>
                    <label>姓名</label>
                    <p class="register_confirm"></p>
                    <!-- <label>生日</label>
                    <p>2000 年 1 月 1 日</p> -->
                    <label>聯絡電話</label>
                    <p class="register_confirm"></p>
                    <label>聯絡地址</label>
                    <p class="register_confirm"></p>
                </div>
            </div>
            <input type = "checkbox" name = "subscription" id = "subscription" required checked>
            <label for = "subscription" style = "font-size: 16px;">訂閱我們，通知您最新優惠消息！</label>
            <br>
            <input type = "checkbox" name = "Agree to terms" id = "Agree to terms" required checked>
            <label for = "Agree to terms" style = "font-size: 16px;">我同意會員條款</label>
            <br>
            <div class = "register_second_button_collection">
                <button type = "button" class = "register_step2_pre_step_button">上一步　修改資料</button>
                <button type = "button" class = "register_step2_next_step_button" onclick="register()">下一步　完成註冊</button>
            </div>
        </form>
    </div>
    <script>
        ;(function() {
            const register_step2_pre_step_button = document.querySelector("button.register_step2_pre_step_button");




            register_step2_pre_step_button.addEventListener("click", function() {
                window.location.href = "./register_step1.html";
            });

            // register_step2_pre_step_button.nextElementSibling.addEventListener("click", function() {
            //     window.location.href = "./register_step3.php";
            // });
        })()
    </script>

    <script>
        let data;
        async function confirm_member(){
            data = 
                await fetch('./API/register_step2.php')
                .then(res => res.json())
                .then(data => data);

            for(i=0; i < $(".register_confirm").length; i++){
                if(i !== 1) {
                    $(".register_confirm")[i].append(data[i]);
                }
            }
            // {
        //         method:'GET',
        //         url:'./API/register_step2.php',
        //         // data:{},
        //         // dataType:'json',
        //         success:function(response){
        //             // response.split
        //             console.log(response);
        //             for(i=0; i < $(".register_confirm").length; i++){
        //                 $(".register_confirm")[i].append(response[i]);
        //             }
        //         },
        //         error: function(exception) {
        //             alert("發生錯誤: " + exception.status);  //網路出錯的部分
        //         }
        //     });
        }
        confirm_member();

        function register(){
                $.ajax({
                    method:'POST',
                    url:'./API/register_step3.php',
                    data:{
                        email: data[0],
                        password:data[1],
                        name: data[2],
                        phone: data[3],
                        address: data[4]
                    },
                    dataType:'text',
                    success:function(response){
                        if(response){
                            // console.log(response);
                            alert(response);
                            window.location.href = "./register_step3.html";
                        }
                    },error: function(exception) {
                        alert("發生錯誤: " + exception.status);  //網路出錯的部分
                    }
                });
            }
    </script>
    @@include('./layout/footer.html')
</body>
</html>